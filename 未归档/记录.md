# 记录

## OX01 ddd的一些讨论

![image-20220418161439421](/Users/zjunothing/Library/Application Support/typora-user-images/image-20220418161439421.png)







## ox02 prepare

1. 高qps服务应对方案：

   1. 缓存。 

      1. 多级缓存（ldb直接当db使用），缓存击穿DB抗。 DB可以设计分库分表降低压力

      2. 缓存大value问题

      3. 缓存预热

      4. 缓存失效问题。

      5. 热点缓存如何解决？ 如热门商家数据： 

         1. 方案一：是增加一个本地缓存，实时探测出热点数据，将热点数据添加到本地缓存，用服务器本地缓存去抗热点流量。（热点如何探测 ==》流计算，过期时间如何设置）
         2. 方案二：缓存key加随机数，再hash到不同结点，解决热点问题。 思想就是将热点数据copy N份到不同的缓存集群结点上来分担压力
         3. 利用cpu缓存，而不是内存。 -> 但是cpu缓存太小，能缓存的数据有限。
         4. 使用tair的限流熔断保护，例如单机超过5000以后，丢弃连接。
         5. [京东hotkey](https://segmentfault.com/a/1190000040465271)

      6. [缓存注意问题](https://exceting.github.io/2019/10/24/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E6%9C%89%E5%85%B3%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98%E6%A2%B3%E7%90%86/)：

         1. 一致性问题
         2. 命中率问题
         3. 缓存穿透问题，没有的key，每次都会回源到DB  
            1. ==》添加dummyValue放入缓存
            2. 但是可能遇到恶意攻击者，传入一大堆没用的key ==》过滤参数，只有符合一般语义的参数，采接受并放dummyValue到缓存。（[布隆过滤器](https://juejin.cn/post/6844904007790673933) 用来存储合理的key，将不合理的key过滤掉）
            3. 
   
         
   
         
   
   2. 分库分表设计
   
      1. 按照那个键分，如何分（hash取模）
      2. 如何用非sharding key来查（按照主键id分库分表，如何用email来查）
      3. 分库分表后的事务，变成分布式事务？
      4. 跨库join问题？